### Потенциальные проблемные места для работы с заказом.
Проблемные места по работе с заказом:
1. Shop Api на моменте загрузки 3-D модели FILE_UPLOADED, необходимо проследить чтобы статус был изменен, 
а файл был действительно загружен на s3 причем не битый
2. При обработке заказа в статусах SUBMITTED - PRICE_CALCULATED в CRM API, когда происходит отправка сообщения в MES, 
для подсчета стоимости и возвращение его обратно в CRM для подтверждения заказа, 
возможно что сообщения не доходят и заказ зависает при расчете, или же MES перегружен расчетами.
3. При работе с заказом в MES системе(самая проблемная часть) от MANUFACTURING_STARTED до CLOSED, возможные проблемы
получение нового заказа после подтверждения из CRM MANUFACTURING_APPROVED и взятием в работу, тут несколько проблем,
транспорт сообщений или же, интерфейс оператора, при высокой загрузке, 
может пропустить необходимый заказ на старт производства из-за проблем с дашбордом, 
аналогичные проблемы с последующими статусами поскольку, как я понимаю все завязано на интерфейс оператора производства.


### Мотивация
1. Надежность при работе с заказом, чтобы не терять клиентов.
2. Надежность при работе с контрактами, чтобы не терять партнеров.

Для пунктов 1-2 В связке с мониторингом, можно отслеживать заказы, которые находятся в статусе сверх нормы,
аномальные заказы, выявлять их до обращения клиента/партнера, а трейсинг поможет разобраться в каком конкретно,
месте происходит затык. И восстановить, состояние заказа для последующей его обработки, для того чтобы уложиться в срок.

3. Трейсинг может помочь выявить, проблемы в бизнес процессах при условии, порядка работы инфраструктуры.
4. Сокращает время поиска неисправности для разработчика при инциденте.
5. Позволяет сэкономить на логах, путем добавления трейсов на жизненно важные участки бизнес процесса, как раз работа
с заказом подходит.

### Предлагаемое решение

Jaeger — для визуализации распределённого трейсинга, как вариант потому что CNCF.
OpenTelemetry SDK (для Spring Boot и .NET компонентов).

Поднимаем Экземпляр Jaeger.
Изменяем, код сервисов в Shop API, CRM API, MES API, добавив туда OpenTelemetry и настроив сбор трейсов в jaeger.
Передача traceContext по HTTP-заголовкам и в сообщениях RabbitMQ(если необходимо)
В трейсинге содержим статическую информацию о ресурсе, нода окружение, заказ, идентификатор пользователя.
Динамическую информацию, параметры вызова адрес вызова метод вызова и т.д.
Контексты, trace_id ид операции - т.е. заказа и span id - операция с заказом.
[Предлагаемое решение гиперссылка](https://drive.google.com/file/d/1AvHmIkc5OivDv_ZOeoOZRiVZA2HC4x5l/view?usp=sharing)
или
[jewerly_c4_model_tracing.drawio](jewerly_c4_model_tracing.drawio) файл в проекте.

### Компромиссы
В зависимости от необходимости, можно попробовать сделать интеграции трейсинга с rabbitMQ. 
Но это может быть трудозатратный процесс. На мой взгляд эффективнее отслеживать dead-letter-exchange.
И возможно повторно отправлять его, шанс, что проблема внутри RabbitMQ не очень велик.

MES система, куплена с исходным кодом, и была осуществлена доработка, api и rabbit mq, предполагаю, что нет проблем
с внедрением OpenTelemetry SDK. Однако если такая проблема была бы, то возможно делать трассировку на каком прокси 
сервисе для MES, результат, будет не такой подробный, но возможно это поможет понять примерно что происходит.

Высокий трафик поднимет нагрузку на сеть. Поэтому в таких случая трассировка может быть не эффективна.
Необходимо следить еще за одним сервисом Jaeger следить за его метриками и чтобы хранилище не было переполнено.

Можно вместо Jaeger использовать Loki + Grafana. Но выбираем классический подход.

### Аспекты безопасности
Работа с трейсингом только через внутреннюю сеть компании, как вариант через VPN, можно сделать,
какой-то white ip list.

Доступ с определенной ролью, поддержка админ и т.д, аутентификация соответственно.

Защищенный шифрованный протокол, передачи.

Ограничить время хранения трейсинга.

Не записывать чувствительные данные в payload трейсов, ФИО почта номера телефона и т д, 
стараться пользоваться идентификаторами, т.е. Обезличенными данными.










